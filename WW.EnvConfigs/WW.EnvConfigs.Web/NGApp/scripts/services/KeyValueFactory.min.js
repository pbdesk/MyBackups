(function(){"use strict";function n(n,t){var u="/api/Values/",r=[],i=[],f=!1,e=function(){return f},o=function(n){f=n},s=function(e){var o=t.defer();return n.get(u+"ByKeyId/"+e).then(function(n){var t=PBDeskJS.Utils.ResolveReferences(n.data);$.each(t,function(n,t){t.EnvKey.EnvValues=null;t.Build.EnvValues=null;t.Locale.EnvValues=null});angular.copy(t,r);angular.copy(t,i);f=!0;o.resolve()},function(){o.reject()}),o.promise},h=function(n){var t=$.grep(r,function(t){return t.Id==n.Id});t!=null&&angular.copy(t[0],n)},c=function(n){var t=$.grep(r,function(t){return t.Id===n.Id})[0];n.IsDirty=t.KeyValue===""?!1:!0;n.KeyValue=""},l=function(){angular.copy(r,i)},a=function(n,t){$.each(i,function(i,r){r.Build.Id==t&&r.KeyValue!=n&&(r.KeyValue=n,r.IsDirty=!0)})},v=function(n,t){$.each(i,function(i,r){r.Locale.Id==t&&r.KeyValue!=n&&(r.KeyValue=n,r.IsDirty=!0)})},y=function(n){$.each(i,function(t,i){i.KeyValue!=n&&(i.KeyValue=n,i.IsDirty=!0)})},p=function(f){var e=t.defer();return n.put(u+"UpdateAll/",f).then(function(n){$.each(i,function(n,t){t.IsDirty=!1});angular.copy(i,r);e.resolve(n.data)},function(){e.reject()}),e.promise},w=function(i){var r=t.defer();return n.put(u+"Update/"+i.Id,i).then(function(n){n.data.IsDirty=!1;b(n.data);r.resolve()},function(){r.reject()}),r.promise},b=function(n){var t=-1;$.each(r,function(i,r){r.Id==n.Id&&(t=i)});t>=0&&(r[t]=n)};return{Values:i,GetValues:s,IsReady:e,SetInitState:o,RevertValue:h,RevertAllValues:l,ApplyValueToAllLocalesForSameEnv:a,ApplyValueToAllBuildsForSameLocale:v,ApplyValueToAll:y,UpdateValue:w,UpdateAll:p,ClearValue:c}}angular.module(WWEnvConfigsAppAppName).factory("KeyValueFactory",["$http","$q",n])})();